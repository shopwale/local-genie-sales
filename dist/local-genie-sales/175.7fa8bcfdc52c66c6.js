"use strict";(self.webpackChunklocal_genie_sales=self.webpackChunklocal_genie_sales||[]).push([[175],{3175:(L,p,c)=>{c.r(p),c.d(p,{ItemsModule:()=>E});var m=c(6895),u=c(6773),e=c(8256),l=c(8809),_=c(529);let h=(()=>{class i{constructor(t){this.http=t}getItemsByServiceProviderId(t){return this.http.get(l.h.GET_ITEMS,{params:{serviceProviderId:t}})}getMeasurements(){return this.http.get(l.h.GET_MEASUREMENTS)}getItemsByCategoryAndSubcategory(t,n,s){return this.http.get(l.h.GET_ITEMS_BY_CATEGORY_AND_SUBCATEGORY,{params:{categoryId:t,subCategoryId:n,itemName:s}})}updateItemPrice(t,n,s){return this.http.patch(l.h.UPDATE_ITEM,{itemId:t,serviceProviderId:n,price:s})}addItem(t,n,s,o){return this.http.post(l.h.ADD_ITEM,{itemName:o,categoryId:t,subCategoryId:n,measurementId:s})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(_.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var b=c(501),C=c(563),v=c(688),a=c(433);function f(i,r){1&i&&e._UZ(0,"i",11)}function I(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"p",14),e.NdJ("click",function(){const o=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.selectSubCategory(o))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit;e.xp6(1),e.Oqu(null==t?null:t.subCategoryName)}}function y(i,r){if(1&i&&(e.TgZ(0,"div",12),e.YNc(1,I,2,1,"p",13),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.subCategories)}}function x(i,r){1&i&&e._UZ(0,"i",15)}function N(i,r){if(1&i&&e._UZ(0,"i"),2&i){const t=e.oxw().$implicit;e.Tol("gg-math-"+(t.show?"minus":"plus"))}}function M(i,r){1&i&&e._UZ(0,"i",23)}function S(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",18),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().$implicit,o=e.oxw(3);return e.KtG(o.updateItemPrice(s))}),e.TgZ(1,"button",31),e._UZ(2,"i",32),e.qZA(),e.TgZ(3,"button",33),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().$implicit,o=e.oxw(3);return e.KtG(o.restoreItemPrice(s))}),e._UZ(4,"i",34),e.qZA()()}}const w=function(i){return{name:i}};function A(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",26)(1,"div",27),e._uU(2),e.qZA(),e.TgZ(3,"div",28)(4,"input",29),e.NdJ("ngModelChange",function(s){const d=e.CHM(t).$implicit;return e.KtG(d.price=s)}),e.qZA(),e.YNc(5,S,5,0,"div",30),e.qZA()()}if(2&i){const t=r.$implicit;e.xp6(1),e.Q6J("ngClass",e.VKq(5,w,t.price&&t.price!=t.backPrice)),e.xp6(1),e.AsE("",null==t?null:t.itemName," (",null==t?null:t.unitOfMeasure,")"),e.xp6(2),e.Q6J("ngModel",t.price),e.xp6(1),e.Q6J("ngIf",t.price&&t.price!=t.backPrice)}}function P(i,r){if(1&i&&(e.TgZ(0,"div",24),e.YNc(1,A,6,7,"div",25),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",null==t?null:t.subItems)}}function T(i,r){1&i&&e._UZ(0,"i",23)}function O(i,r){if(1&i&&(e.TgZ(0,"option",44),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.measurementId),e.xp6(1),e.hij(" ",t.unitOfMeasure,"")}}function Z(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"p",14),e.NdJ("click",function(){const o=e.CHM(t).$implicit,d=e.oxw(3).$implicit,g=e.oxw();return e.KtG(g.selectItem(o,d))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit;e.xp6(1),e.AsE(" ",null==t?null:t.itemName," (",null==t?null:t.unitOfMeasure,")")}}function J(i,r){if(1&i&&(e.TgZ(0,"div",45),e.YNc(1,Z,2,2,"p",13),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngForOf",t.itemsList)}}function k(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",35)(1,"div",36)(2,"div",3)(3,"input",37),e.NdJ("ngModelChange",function(s){e.CHM(t);const o=e.oxw().$implicit;return e.KtG(o.itemName=s)})("keyup",function(){e.CHM(t);const s=e.oxw().$implicit,o=e.oxw();return e.KtG(o.getItemsByName(s))}),e.qZA(),e.YNc(4,T,1,0,"i",20),e.qZA(),e.TgZ(5,"select",38),e.NdJ("ngModelChange",function(s){e.CHM(t);const o=e.oxw().$implicit;return e.KtG(o.measurementId=s)}),e.TgZ(6,"option",39),e._uU(7,"Unit"),e.qZA(),e.YNc(8,O,2,2,"option",40),e.qZA(),e.TgZ(9,"input",41),e.NdJ("ngModelChange",function(s){e.CHM(t);const o=e.oxw().$implicit;return e.KtG(o.itemPrice=s)}),e.qZA(),e.TgZ(10,"button",42),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().$implicit,o=e.oxw();return e.KtG(o.addItem(s))}),e._UZ(11,"i",32),e.qZA()(),e.YNc(12,J,2,1,"div",43),e.qZA()}if(2&i){const t=e.oxw().$implicit,n=e.oxw();e.xp6(3),e.Q6J("ngModel",t.itemName),e.xp6(1),e.Q6J("ngIf",t.showSpinner),e.xp6(1),e.Q6J("name","item"+t.subCategoryId)("ngModel",t.measurementId),e.xp6(3),e.Q6J("ngForOf",n.measurements),e.xp6(1),e.Q6J("name","price"+t.subCategoryId)("ngModel",t.itemPrice),e.xp6(1),e.Q6J("disabled",!t.itemName||t.itemName.length<3||!t.measurementId),e.xp6(2),e.Q6J("ngIf",t.showList)}}function B(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",16)(1,"h4",17)(2,"span"),e._uU(3),e.qZA(),e.TgZ(4,"span",18),e.NdJ("click",function(){const o=e.CHM(t).$implicit;return e.KtG(o.show=!o.show)}),e.YNc(5,N,1,2,"i",19),e.YNc(6,M,1,0,"i",20),e.qZA()(),e.YNc(7,P,2,1,"div",21),e.YNc(8,k,13,9,"div",22),e.qZA()}if(2&i){const t=r.$implicit;e.xp6(3),e.Oqu(t.subCategoryName),e.xp6(2),e.Q6J("ngIf",!t.loading),e.xp6(1),e.Q6J("ngIf",t.loading),e.xp6(1),e.Q6J("ngIf",(null==t?null:t.subItems)&&(null==t||null==t.subItems?null:t.subItems.length)),e.xp6(1),e.Q6J("ngIf",t.show)}}const F=[{path:"add",component:(()=>{class i{constructor(t,n,s,o){this.itemsService=t,this.activatedRoute=n,this.categoryService=s,this.serviceProviderService=o,this.subCategoryName="",this.categoryName="",this.showSubcategoryList=!1,this.disabledSubCategory=!0,this.items=[],this.measurements=[],this.subCategories=[],this.title="Add Items",this.showSpinner=!1,this.showSpinnerSubCategory=!1}ngOnInit(){this.activatedRoute.queryParamMap.subscribe(t=>{console.log(t.getAll("businessCode")),this.serviceProviderId=Number(t.get("serviceProviderId")),this.categoryId=Number(t.get("categoryId")),this.businesCode=String(t.get("businessCode")),console.log(this.businesCode),this.getItemsByServiceProvider(),this.getMeasurements(),this.getServiceProviderByBusinessCode()})}getMeasurements(){this.itemsService.getMeasurements().subscribe(t=>{this.measurements=t},t=>{console.log(t)})}addSubCategory(){this.categoryService.AddSubCategory(this.categoryId,this.subCategoryName).subscribe(t=>{this.items.unshift({categoryId:this.categoryId,categoryName:this.categoryName,subCategoryName:this.subCategoryName,subCategoryId:t.subCategoryId,measurementId:"",itemPrice:0,subItems:[],isOpen:!1,show:!1,showList:!1,loading:!1}),this.showSubcategoryList=!1,this.subCategoryName=""},t=>{console.log(t)})}getItemsByName(t){if(!t.itemName)return t.showList=!1,void(t.showSpinner=!1);this.interval&&clearTimeout(this.interval),this.interval=setTimeout(()=>{t.showSpinner=!0,t.showList=!1,this.itemsService.getItemsByCategoryAndSubcategory(t.categoryId,t.subCategoryId,t.itemName).subscribe(n=>{const s=t.subItems.map(o=>o.itemName);t.itemsList=n.filter(o=>!s.includes(o.itemName)),console.log(t),t.showList=!!t.itemsList.length,t.showSpinner=!1},n=>{t.showSpinner=!1})},300)}selectSubCategory(t){console.log(t),this.subCategoryName="",this.showSubcategoryList=!1,this.items.unshift({categoryId:this.categoryId,categoryName:this.categoryName,subCategoryName:t.subCategoryName,subCategoryId:t.subCategoryId,measurementId:"",itemPrice:0,subItems:[],isOpen:!1,show:!1,showList:!1,loading:!1})}getSubCategoriesByName(){if(console.log(this.subCategoryName),!this.subCategoryName)return this.showSubcategoryList=!1,void(this.showSpinnerSubCategory=!1);this.interval&&clearTimeout(this.interval),this.interval=setTimeout(()=>{this.showSpinnerSubCategory=!0,this.categoryService.GetSubCategoriesWithCategoryId({subCategoryName:this.subCategoryName,categoryId:this.categoryId}).subscribe(t=>{const n=this.items.map(s=>s.subCategoryName);this.subCategories=t.filter(s=>!n.includes(s.subCategoryName)),this.showSubcategoryList=!!this.subCategories.length,this.showSpinnerSubCategory=!1},t=>{console.log(t),this.showSpinnerSubCategory=!1})},300)}selectItem(t,n){console.log(n,t),n.showList=!1,n.itemName="",this.serviceProviderService.mapItemToServiceProvider(Number(this.serviceProviderId),t.itemId,0).subscribe(s=>{console.log(s),n.subItems.push({...t,subItems:"",price:0,show:!1})})}toggleSubCategory(){this.subCategoryName="",this.showSubcategoryList=!this.showSubcategoryList}restoreItemPrice(t){t.price=JSON.parse(JSON.stringify(t.backPrice))}updateItemPrice(t){console.log(t),this.itemsService.updateItemPrice(t.itemId,Number(this.serviceProviderId),t.price).subscribe(n=>{console.log(n),t.backPrice=t.price},n=>{console.log(n)})}addItem(t){console.log(t),t.loading=!0,this.itemsService.addItem(t.categoryId,t.subCategoryId,Number(t.measurementId),t.itemName).subscribe(n=>{t.show=!1,this.serviceProviderService.mapItemToServiceProvider(Number(this.serviceProviderId),n.itemId,t.itemPrice).subscribe(s=>{console.log(s),this.getItemsByServiceProvider()},s=>{t.loading=!1})},n=>{t.loading=!1})}getItemsByServiceProvider(){this.showSpinner=!0,this.itemsService.getItemsByServiceProviderId(this.serviceProviderId).subscribe(t=>{console.log(t),this.items=Object.values(t.reduce((n,s)=>(this.categoryName=s.categoryName,n[s.subCategoryName]||(n[s.subCategoryName]={categoryName:s.categoryName,categoryId:this.categoryId,subCategoryName:s.subCategoryName,subCategoryId:s.subCategoryId,measurementId:"",itemPrice:0,subItems:[],isOpen:!1,show:!1,showList:!1,loading:!1}),n[s.subCategoryName].subItems.push({itemId:s.itemId,show:!0,itemName:s.itemName,price:s.price,backPrice:s.price,subItems:Array.isArray(s.subItems)&&s.subItems.reduce((o,d,g)=>o+(g?(g!==s.subItems.length-1?", ":" and ")+d.itemName:d.itemName),"")||"",unitOfMeasure:s.unitOfMeasure,itemIconURL:s.itemIconURL}),n),{})),this.showSpinner=!1,console.log(this.items)},t=>{this.showSpinner=!1,console.log(t)})}getServiceProviderByBusinessCode(){this.serviceProviderService.getServiceProviderByBusinessCode(this.businesCode).subscribe(t=>{this.title+=" - "+t.serviceProviderName},t=>{console.log(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h),e.Y36(u.gz),e.Y36(b.G),e.Y36(C.G))},i.\u0275cmp=e.Xpm({type:i,selectors:[["lgs-add-items"]],decls:11,vars:8,consts:[[3,"title","showBack"],[1,"body"],[1,"p-10","pos-relative"],[1,"spinner-block"],["type","text","name","subCategoryName","placeholder","Enter New Sub Category Name",1,"sub-category-name-input",3,"ngModel","ngModelChange","keyup"],["class","gg-spinner sub-categories",4,"ngIf"],[1,"button-filled","add-sub-category",3,"disabled","click"],[1,"gg-math-plus"],["class","sub-categories-list",4,"ngIf"],["class","gg-spinner m-lr-auto m-t-10",4,"ngIf"],["class","card",4,"ngFor","ngForOf"],[1,"gg-spinner","sub-categories"],[1,"sub-categories-list"],["class","text-capitalize",3,"click",4,"ngFor","ngForOf"],[1,"text-capitalize",3,"click"],[1,"gg-spinner","m-lr-auto","m-t-10"],[1,"card"],[1,"title","text-capitalize"],[3,"click"],[3,"class",4,"ngIf"],["class","gg-spinner",4,"ngIf"],["class","p-10",4,"ngIf"],["class","pos-relative",4,"ngIf"],[1,"gg-spinner"],[1,"p-10"],["class","sub-items",4,"ngFor","ngForOf"],[1,"sub-items"],[3,"ngClass"],[1,"flex"],["type","number",3,"ngModel","ngModelChange"],[3,"click",4,"ngIf"],[1,"button-filled"],[1,"gg-chevron-right"],[1,"button-border",3,"click"],[1,"gg-close"],[1,"pos-relative"],[1,"flex","new-item"],["type","text","name","itemName","placeholder","Item Name",1,"sub-category-name-input",3,"ngModel","ngModelChange","keyup"],[1,"m-b-0",3,"name","ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Price",3,"name","ngModel","ngModelChange"],[1,"button-filled","add-item",3,"disabled","click"],["class","sub-categories-list items-list",4,"ngIf"],[3,"value"],[1,"sub-categories-list","items-list"]],template:function(t,n){1&t&&(e._UZ(0,"lgs-header",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"input",4),e.NdJ("ngModelChange",function(o){return n.subCategoryName=o})("keyup",function(){return n.getSubCategoriesByName()}),e.qZA(),e.YNc(5,f,1,0,"i",5),e.qZA(),e.TgZ(6,"button",6),e.NdJ("click",function(){return n.addSubCategory()}),e._UZ(7,"i",7),e.qZA(),e.YNc(8,y,2,1,"div",8),e.qZA(),e.YNc(9,x,1,0,"i",9),e.YNc(10,B,9,5,"div",10),e.qZA()),2&t&&(e.Q6J("title",n.title)("showBack",!0),e.xp6(4),e.Q6J("ngModel",n.subCategoryName),e.xp6(1),e.Q6J("ngIf",n.showSpinnerSubCategory),e.xp6(1),e.Q6J("disabled",!n.subCategoryName||n.subCategoryName.length<3),e.xp6(2),e.Q6J("ngIf",n.showSubcategoryList),e.xp6(1),e.Q6J("ngIf",n.showSpinner),e.xp6(1),e.Q6J("ngForOf",n.items))},dependencies:[m.mk,m.sg,m.O5,v.G,a.YN,a.Kr,a.Fj,a.wV,a.EJ,a.JJ,a.On],styles:[".body[_ngcontent-%COMP%]{padding-bottom:120px}.button-filled.add-sub-category[_ngcontent-%COMP%], .button-filled.add-item[_ngcontent-%COMP%]{min-width:unset;height:51px;position:absolute}.button-filled.add-sub-category[_ngcontent-%COMP%]{right:10px;top:10px}.button-filled.add-item[_ngcontent-%COMP%]{position:relative;padding:10px 5px}select[_ngcontent-%COMP%]{width:100px;margin:0 10px}.sub-category-name-input[_ngcontent-%COMP%]{margin:0}.spinner-block[_ngcontent-%COMP%]{position:relative}.spinner-block[_ngcontent-%COMP%]   .gg-spinner[_ngcontent-%COMP%]{position:absolute;right:5px;top:10px}.spinner-block[_ngcontent-%COMP%]   .gg-spinner.sub-categories[_ngcontent-%COMP%]{right:60px;top:15px}.sub-categories-list[_ngcontent-%COMP%]{position:absolute;z-index:1;background:#fff;top:60px;right:10px;left:10px;padding:10px;border-bottom-left-radius:10px;border:1px solid var(--background-color);border-bottom-right-radius:10px;box-shadow:#64646f33 0 7px 29px;max-height:115px;overflow-y:auto}.sub-categories-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;border-bottom:1px solid var(--background-color);margin:0;padding:10px 5px}.sub-categories-list.items-list[_ngcontent-%COMP%]{top:50px;left:0;right:0}.title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.sub-items[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin:0}.sub-items[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{max-width:55%}.sub-items[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:10px 5px;text-align:center;width:50px;margin-top:10px;margin-bottom:0}.sub-items[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:auto;margin-top:10px;padding:7px 5px}.new-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .new-item[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .new-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 5px;margin-bottom:0;height:auto;font-size:13px}.new-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px}.new-item[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:50px;margin-top:0}"]}),i})()},{path:"",pathMatch:"full",redirectTo:"add"}];let Q=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[u.Bz.forChild(F),u.Bz]}),i})();var Y=c(5130);let E=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[m.ez,Q,Y.O,a.u5]}),i})()}}]);