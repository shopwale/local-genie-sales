"use strict";(self.webpackChunklocal_genie_sales=self.webpackChunklocal_genie_sales||[]).push([[810],{6810:(z,_,c)=>{c.r(_),c.d(_,{ItemsModule:()=>K});var u=c(6895),p=c(6773);function h(n,r,t,i,o,s,a){try{var d=n[s](a),g=d.value}catch(R){return void t(R)}d.done?r(g):Promise.resolve(g).then(i,o)}function v(n){return function(){var r=this,t=arguments;return new Promise(function(i,o){var s=n.apply(r,t);function a(g){h(s,i,o,a,d,"next",g)}function d(g){h(s,i,o,a,d,"throw",g)}a(void 0)})}}var e=c(8256),m=c(8809),f=c(529);let b=(()=>{class n{constructor(t){this.http=t}getItemsByServiceProviderId(t){return this.http.get(m.h.GET_ITEMS,{params:{serviceProviderId:t}})}getMeasurements(){return this.http.get(m.h.GET_MEASUREMENTS)}getItemsByCategoryAndSubcategory(t,i,o){return this.http.get(m.h.GET_ITEMS_BY_CATEGORY_AND_SUBCATEGORY,{params:{categoryId:t,subCategoryId:i,itemName:o}})}updateItemPrice(t,i,o){return this.http.patch(m.h.UPDATE_ITEM,{itemId:t,serviceProviderId:i,price:o})}addItem(t,i,o,s){return this.http.post(m.h.ADD_ITEM,{itemName:s,categoryId:t,subCategoryId:i,measurementId:o})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var C=c(501),I=c(563),y=c(2013),x=c(688),l=c(433);const w=["img"];function N(n,r){1&n&&e._UZ(0,"i",16)}function M(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p",19),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.selectSubCategory(s))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit;e.xp6(1),e.Oqu(null==t?null:t.subCategoryName)}}function P(n,r){if(1&n&&(e.TgZ(0,"div",17),e.YNc(1,M,2,1,"p",18),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.subCategories)}}function S(n,r){1&n&&e._UZ(0,"i",20)}function A(n,r){if(1&n&&e._UZ(0,"i"),2&n){const t=e.oxw().$implicit;e.Tol("gg-math-"+(t.show?"minus":"plus"))}}function T(n,r){1&n&&e._UZ(0,"i",28)}function O(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",23),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,s=e.oxw(3);return e.KtG(s.updateItemPrice(o))}),e.TgZ(1,"button",36),e._UZ(2,"i",37),e.qZA(),e.TgZ(3,"button",38),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,s=e.oxw(3);return e.KtG(s.restoreItemPrice(o))}),e._UZ(4,"i",39),e.qZA()()}}const Z=function(n){return{name:n}};function J(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",31)(1,"div",32),e._uU(2),e.qZA(),e.TgZ(3,"div",33)(4,"input",34),e.NdJ("ngModelChange",function(o){const a=e.CHM(t).$implicit;return e.KtG(a.price=o)}),e.qZA(),e.YNc(5,O,5,0,"div",35),e.qZA()()}if(2&n){const t=r.$implicit;e.xp6(1),e.Q6J("ngClass",e.VKq(5,Z,t.price&&t.price!=t.backPrice)),e.xp6(1),e.AsE("",null==t?null:t.itemName," (",null==t?null:t.unitOfMeasure,")"),e.xp6(2),e.Q6J("ngModel",t.price),e.xp6(1),e.Q6J("ngIf",t.price&&t.price!=t.backPrice)}}function k(n,r){if(1&n&&(e.TgZ(0,"div",29),e.YNc(1,J,6,7,"div",30),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",null==t?null:t.subItems)}}function E(n,r){1&n&&e._UZ(0,"i",28)}function L(n,r){if(1&n&&(e.TgZ(0,"option",49),e._uU(1),e.qZA()),2&n){const t=r.$implicit;e.Q6J("value",t.measurementId),e.xp6(1),e.hij(" ",t.unitOfMeasure,"")}}function Q(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p",19),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw(3).$implicit,d=e.oxw();return e.KtG(d.selectItem(s,a))}),e._uU(1),e.qZA()}if(2&n){const t=r.$implicit;e.xp6(1),e.AsE(" ",null==t?null:t.itemName," (",null==t?null:t.unitOfMeasure,")")}}function Y(n,r){if(1&n&&(e.TgZ(0,"div",50),e.YNc(1,Q,2,2,"p",18),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngForOf",t.itemsList)}}function B(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",40)(1,"div",41)(2,"div",3)(3,"input",42),e.NdJ("ngModelChange",function(o){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.itemName=o)})("keyup",function(){e.CHM(t);const o=e.oxw().$implicit,s=e.oxw();return e.KtG(s.getItemsByName(o))}),e.qZA(),e.YNc(4,E,1,0,"i",25),e.qZA(),e.TgZ(5,"select",43),e.NdJ("ngModelChange",function(o){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.measurementId=o)}),e.TgZ(6,"option",44),e._uU(7,"Unit"),e.qZA(),e.YNc(8,L,2,2,"option",45),e.qZA(),e.TgZ(9,"input",46),e.NdJ("ngModelChange",function(o){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.itemPrice=o)}),e.qZA(),e.TgZ(10,"button",47),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,s=e.oxw();return e.KtG(s.addItem(o))}),e._UZ(11,"i",37),e.qZA()(),e.YNc(12,Y,2,1,"div",48),e.qZA()}if(2&n){const t=e.oxw().$implicit,i=e.oxw();e.xp6(3),e.Q6J("ngModel",t.itemName),e.xp6(1),e.Q6J("ngIf",t.showSpinner),e.xp6(1),e.Q6J("name","item"+t.subCategoryId)("ngModel",t.measurementId),e.xp6(3),e.Q6J("ngForOf",i.measurements),e.xp6(1),e.Q6J("name","price"+t.subCategoryId)("ngModel",t.itemPrice),e.xp6(1),e.Q6J("disabled",!t.itemName||t.itemName.length<3||!t.measurementId),e.xp6(2),e.Q6J("ngIf",t.showList)}}function G(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",21)(1,"h4",22)(2,"span"),e._uU(3),e.qZA(),e.TgZ(4,"span",23),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.KtG(s.show=!s.show)}),e.YNc(5,A,1,2,"i",24),e.YNc(6,T,1,0,"i",25),e.qZA()(),e.YNc(7,k,2,1,"div",26),e.YNc(8,B,13,9,"div",27),e.qZA()}if(2&n){const t=r.$implicit;e.xp6(3),e.Oqu(t.subCategoryName),e.xp6(2),e.Q6J("ngIf",!t.loading),e.xp6(1),e.Q6J("ngIf",t.loading),e.xp6(1),e.Q6J("ngIf",(null==t?null:t.subItems)&&(null==t||null==t.subItems?null:t.subItems.length)),e.xp6(1),e.Q6J("ngIf",t.show)}}function U(n,r){if(1&n&&(e.TgZ(0,"div",51)(1,"a",52),e._UZ(2,"i",53),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("href",t.whatasppLink,e.LSH)}}function q(n,r){if(1&n&&(e.TgZ(0,"div",54)(1,"a",55),e._UZ(2,"i",56),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("href",t.serviceProvider.qrCode,e.LSH)("download",t.serviceProvider.serviceProviderName+".png")}}const F=[{path:"add",component:(()=>{class n{constructor(t,i,o,s,a){this.itemsService=t,this.activatedRoute=i,this.categoryService=o,this.serviceProviderService=s,this.notificationService=a,this.subCategoryName="",this.categoryName="",this.showSubcategoryList=!1,this.disabledSubCategory=!0,this.showShare=!1,this.items=[],this.measurements=[],this.subCategories=[],this.title="Add Items",this.showSpinner=!1,this.showSpinnerSubCategory=!1,this.whatasppLink="",this.serviceProvider={serviceProviderName:"",pinCode:"",mobileNumber:0,address:""}}ngAfterViewInit(){console.log(this.img.nativeElement)}ngOnInit(){this.activatedRoute.queryParamMap.subscribe(t=>{console.log(t.getAll("businessCode")),this.categoryId=Number(t.get("categoryId")),this.getServiceProviderByBusinessCode(String(t.get("businessCode"))),this.getItemsByServiceProvider(Number(t.get("serviceProviderId"))),this.getMeasurements()})}getMeasurements(){this.itemsService.getMeasurements().subscribe(t=>{this.measurements=t},t=>{console.log(t),this.notificationService.showError(t?.error?.message||t?.statusText)})}addSubCategory(){this.categoryService.AddSubCategory(this.categoryId,this.subCategoryName).subscribe(t=>{this.items.unshift({categoryId:this.categoryId,categoryName:this.categoryName,subCategoryName:this.subCategoryName,subCategoryId:t.subCategoryId,measurementId:"",itemPrice:0,subItems:[],isOpen:!1,show:!1,showList:!1,loading:!1}),this.showSubcategoryList=!1,this.subCategoryName=""},t=>{console.log(t),this.notificationService.showError(t?.error?.message||t?.statusText)})}getItemsByName(t){if(!t.itemName)return t.showList=!1,void(t.showSpinner=!1);this.interval&&clearTimeout(this.interval),this.interval=setTimeout(()=>{t.showSpinner=!0,t.showList=!1,this.itemsService.getItemsByCategoryAndSubcategory(t.categoryId,t.subCategoryId,t.itemName).subscribe(i=>{const o=t.subItems.map(s=>s.itemName);t.itemsList=i.filter(s=>!o.includes(s.itemName)),console.log(t),t.showList=!!t.itemsList.length,t.showSpinner=!1},i=>{t.showSpinner=!1,this.notificationService.showError(i?.error?.message||i?.statusText)})},300)}selectSubCategory(t){console.log(t),this.subCategoryName="",this.showSubcategoryList=!1,this.items.unshift({categoryId:this.categoryId,categoryName:this.categoryName,subCategoryName:t.subCategoryName,subCategoryId:t.subCategoryId,measurementId:"",itemPrice:0,subItems:[],isOpen:!1,show:!1,showList:!1,loading:!1})}getSubCategoriesByName(){if(console.log(this.subCategoryName),!this.subCategoryName)return this.showSubcategoryList=!1,void(this.showSpinnerSubCategory=!1);this.interval&&clearTimeout(this.interval),this.interval=setTimeout(()=>{this.showSpinnerSubCategory=!0,this.categoryService.GetSubCategoriesWithCategoryId({subCategoryName:this.subCategoryName,categoryId:this.categoryId}).subscribe(t=>{const i=this.items.map(o=>o.subCategoryName);this.subCategories=t.filter(o=>!i.includes(o.subCategoryName)),this.showSubcategoryList=!!this.subCategories.length,this.showSpinnerSubCategory=!1},t=>{console.log(t),this.notificationService.showError(t?.error?.message||t?.statusText),this.showSpinnerSubCategory=!1})},300)}selectItem(t,i){console.log(i,t),i.showList=!1,i.itemName="",this.serviceProviderService.mapItemToServiceProvider(Number(this.serviceProvider.serviceProviderId),t.itemId,0).subscribe(o=>{console.log(o),i.subItems.push({...t,subItems:"",price:0,show:!1})},o=>{this.notificationService.showError(o?.error?.message||o?.statusText)})}toggleSubCategory(){this.subCategoryName="",this.showSubcategoryList=!this.showSubcategoryList}restoreItemPrice(t){t.price=JSON.parse(JSON.stringify(t.backPrice))}updateItemPrice(t){console.log(t),this.itemsService.updateItemPrice(t.itemId,Number(this.serviceProvider.serviceProviderId),t.price).subscribe(i=>{console.log(i),t.backPrice=t.price},i=>{console.log(i),this.notificationService.showError(i?.error?.message||i?.statusText)})}addItem(t){console.log(t),t.loading=!0,this.itemsService.addItem(t.categoryId,t.subCategoryId,Number(t.measurementId),t.itemName).subscribe(i=>{t.show=!1,this.serviceProviderService.mapItemToServiceProvider(Number(this.serviceProvider.serviceProviderId),i.itemId,t.itemPrice).subscribe(o=>{console.log(o),this.getItemsByServiceProvider(Number(this.serviceProvider.serviceProviderId))},o=>{t.loading=!1})},i=>{t.loading=!1,this.notificationService.showError(i?.error?.message||i?.statusText)})}getItemsByServiceProvider(t){this.showSpinner=!0,console.log(this.serviceProvider),this.itemsService.getItemsByServiceProviderId(t).subscribe(i=>{console.log(i),this.items=Object.values(i.reduce((o,s)=>(this.categoryName=s.categoryName,o[s.subCategoryName]||(o[s.subCategoryName]={categoryName:s.categoryName,categoryId:this.categoryId,subCategoryName:s.subCategoryName,subCategoryId:s.subCategoryId,measurementId:"",itemPrice:0,subItems:[],isOpen:!1,show:!1,showList:!1,loading:!1}),o[s.subCategoryName].subItems.push({itemId:s.itemId,show:!0,itemName:s.itemName,price:s.price,backPrice:s.price,subItems:Array.isArray(s.subItems)&&s.subItems.reduce((a,d,g)=>a+(g?(g!==s.subItems.length-1?", ":" and ")+d.itemName:d.itemName),"")||"",unitOfMeasure:s.unitOfMeasure,itemIconURL:s.itemIconURL}),o),{})),this.showSpinner=!1,console.log(this.items)},i=>{this.showSpinner=!1,console.log(i),this.notificationService.showError(i?.error?.message||i?.statusText)})}getServiceProviderByBusinessCode(t){var i=this;this.serviceProviderService.getServiceProviderByBusinessCode(t).subscribe(function(){var o=v(function*(s){i.title+=" - "+s.serviceProviderName,i.serviceProvider=s,yield i.getLink(String(s.qrCode))});return function(s){return o.apply(this,arguments)}}(),o=>{console.log(o),this.notificationService.showError(o?.error?.message||o?.statusText)})}getLink(t){var i=this;return v(function*(){try{let o=`Welcome to Local Genie.\nBelow is your qr code\n ${t}`;i.whatasppLink=`https://wa.me/${i.serviceProvider?.mobileNumber}/?text=${encodeURIComponent(o)}`,console.log(i.whatasppLink)}catch(o){console.log(o)}})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(b),e.Y36(p.gz),e.Y36(C.G),e.Y36(I.G),e.Y36(y.g))},n.\u0275cmp=e.Xpm({type:n,selectors:[["lgs-add-items"]],viewQuery:function(t,i){if(1&t&&e.Gf(w,5),2&t){let o;e.iGM(o=e.CRH())&&(i.img=o.first)}},decls:16,vars:11,consts:[[3,"title","showBack"],[1,"body"],[1,"p-10","pos-relative"],[1,"spinner-block"],["type","text","name","subCategoryName","placeholder","Enter New Sub Category Name",1,"sub-category-name-input",3,"ngModel","ngModelChange","keyup"],["class","gg-spinner sub-categories",4,"ngIf"],[1,"button-filled","add-sub-category",3,"disabled","click"],[1,"gg-math-plus"],["class","sub-categories-list",4,"ngIf"],["class","gg-spinner m-lr-auto m-t-10",4,"ngIf"],["class","card",4,"ngFor","ngForOf"],[1,"fab-icon",3,"click"],[3,"src"],["img",""],["class","share",4,"ngIf"],["class","download",4,"ngIf"],[1,"gg-spinner","sub-categories"],[1,"sub-categories-list"],["class","text-capitalize",3,"click",4,"ngFor","ngForOf"],[1,"text-capitalize",3,"click"],[1,"gg-spinner","m-lr-auto","m-t-10"],[1,"card"],[1,"title","text-capitalize"],[3,"click"],[3,"class",4,"ngIf"],["class","gg-spinner",4,"ngIf"],["class","p-10",4,"ngIf"],["class","pos-relative",4,"ngIf"],[1,"gg-spinner"],[1,"p-10"],["class","sub-items",4,"ngFor","ngForOf"],[1,"sub-items"],[3,"ngClass"],[1,"flex"],["type","number",3,"ngModel","ngModelChange"],[3,"click",4,"ngIf"],[1,"button-filled"],[1,"gg-chevron-right"],[1,"button-border",3,"click"],[1,"gg-close"],[1,"pos-relative"],[1,"flex","new-item"],["type","text","name","itemName","placeholder","Item Name",1,"sub-category-name-input",3,"ngModel","ngModelChange","keyup"],[1,"m-b-0",3,"name","ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Price",3,"name","ngModel","ngModelChange"],[1,"button-filled","add-item",3,"disabled","click"],["class","sub-categories-list items-list",4,"ngIf"],[3,"value"],[1,"sub-categories-list","items-list"],[1,"share"],["target","_blank",3,"href"],[1,"gg-share"],[1,"download"],["target","_blank",3,"href","download"],[1,"gg-software-download"]],template:function(t,i){1&t&&(e._UZ(0,"lgs-header",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"input",4),e.NdJ("ngModelChange",function(s){return i.subCategoryName=s})("keyup",function(){return i.getSubCategoriesByName()}),e.qZA(),e.YNc(5,N,1,0,"i",5),e.qZA(),e.TgZ(6,"button",6),e.NdJ("click",function(){return i.addSubCategory()}),e._UZ(7,"i",7),e.qZA(),e.YNc(8,P,2,1,"div",8),e.qZA(),e.YNc(9,S,1,0,"i",9),e.YNc(10,G,9,5,"div",10),e.TgZ(11,"div",11),e.NdJ("click",function(){return i.showShare=!i.showShare}),e._UZ(12,"img",12,13),e.qZA(),e.YNc(14,U,3,1,"div",14),e.YNc(15,q,3,2,"div",15),e.qZA()),2&t&&(e.Q6J("title",i.title)("showBack",!0),e.xp6(4),e.Q6J("ngModel",i.subCategoryName),e.xp6(1),e.Q6J("ngIf",i.showSpinnerSubCategory),e.xp6(1),e.Q6J("disabled",!i.subCategoryName||i.subCategoryName.length<3),e.xp6(2),e.Q6J("ngIf",i.showSubcategoryList),e.xp6(1),e.Q6J("ngIf",i.showSpinner),e.xp6(1),e.Q6J("ngForOf",i.items),e.xp6(2),e.Q6J("src",i.serviceProvider.qrCode,e.LSH),e.xp6(2),e.Q6J("ngIf",i.showShare),e.xp6(1),e.Q6J("ngIf",i.showShare))},dependencies:[u.mk,u.sg,u.O5,x.G,l.YN,l.Kr,l.Fj,l.wV,l.EJ,l.JJ,l.On],styles:[".body[_ngcontent-%COMP%]{padding-bottom:120px}.button-filled.add-sub-category[_ngcontent-%COMP%], .button-filled.add-item[_ngcontent-%COMP%]{min-width:unset;height:51px;position:absolute}.button-filled.add-sub-category[_ngcontent-%COMP%]{right:10px;top:10px}.button-filled.add-item[_ngcontent-%COMP%]{position:relative;padding:10px 5px}select[_ngcontent-%COMP%]{width:100px;margin:0 10px}.sub-category-name-input[_ngcontent-%COMP%]{margin:0}.spinner-block[_ngcontent-%COMP%]{position:relative}.spinner-block[_ngcontent-%COMP%]   .gg-spinner[_ngcontent-%COMP%]{position:absolute;right:5px;top:10px}.spinner-block[_ngcontent-%COMP%]   .gg-spinner.sub-categories[_ngcontent-%COMP%]{right:60px;top:15px}.sub-categories-list[_ngcontent-%COMP%]{position:absolute;z-index:1;background:#fff;top:60px;right:10px;left:10px;padding:10px;border-bottom-left-radius:10px;border:1px solid var(--background-color);border-bottom-right-radius:10px;box-shadow:#64646f33 0 7px 29px;max-height:115px;overflow-y:auto}.sub-categories-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;border-bottom:1px solid var(--background-color);margin:0;padding:10px 5px}.sub-categories-list.items-list[_ngcontent-%COMP%]{top:50px;left:0;right:0}.title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.sub-items[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin:0}.sub-items[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{max-width:55%}.sub-items[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:10px 5px;text-align:center;width:50px;margin-top:10px;margin-bottom:0}.sub-items[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:auto;margin-top:10px;padding:7px 5px}.new-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .new-item[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .new-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 5px;margin-bottom:0;height:auto;font-size:13px}.new-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px}.new-item[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:50px;margin-top:0}.fab-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{left:40%}.share[_ngcontent-%COMP%], .download[_ngcontent-%COMP%]{background:#fff;position:fixed;right:23px;padding:13px 12px;width:14px;height:10px;border:2px solid;border-radius:50%}.share[_ngcontent-%COMP%]{bottom:77px}.share[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:-2px;margin-top:2px}.download[_ngcontent-%COMP%]{bottom:125px}.download[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-top:7px}"]}),n})()},{path:"",pathMatch:"full",redirectTo:"add"}];let $=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.Bz.forChild(F),p.Bz]}),n})();var H=c(5130);let K=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[u.ez,$,H.O,l.u5]}),n})()}}]);