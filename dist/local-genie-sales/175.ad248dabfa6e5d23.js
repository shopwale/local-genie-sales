"use strict";(self.webpackChunklocal_genie_sales=self.webpackChunklocal_genie_sales||[]).push([[175],{3175:(Q,p,c)=>{c.r(p),c.d(p,{ItemsModule:()=>E});var l=c(6895),g=c(6773),e=c(8256),m=c(8809),_=c(529);let b=(()=>{class i{constructor(t){this.http=t}getItemsByServiceProviderId(t){return this.http.get(m.h.GET_ITEMS,{params:{serviceProviderId:t}})}getMeasurements(){return this.http.get(m.h.GET_MEASUREMENTS)}getItemsByCategoryAndSubcategory(t,s,n){return this.http.get(m.h.GET_ITEMS_BY_CATEGORY_AND_SUBCATEGORY,{params:{categoryId:t,subCategoryId:s,itemName:n}})}updateItemPrice(t,s,n){return this.http.patch(m.h.UPDATE_ITEM,{itemId:t,serviceProviderId:s,price:n})}addItem(t,s,n,o){return this.http.post(m.h.ADD_ITEM,{itemName:o,categoryId:t,subCategoryId:s,measurementId:n})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(_.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var h=c(501),C=c(563),v=c(688),a=c(433);function I(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"p",10),e.NdJ("click",function(){const o=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.selectSubCategory(o))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit;e.xp6(1),e.Oqu(null==t?null:t.subCategoryName)}}function f(i,r){if(1&i&&(e.TgZ(0,"div",8),e.YNc(1,I,2,1,"p",9),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.subCategories)}}function y(i,r){if(1&i&&e._UZ(0,"i"),2&i){const t=e.oxw().$implicit;e.Tol("gg-math-"+(t.show?"minus":"plus"))}}function x(i,r){1&i&&e._UZ(0,"i",18)}function N(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",13),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,o=e.oxw(3);return e.KtG(o.updateItemPrice(n))}),e.TgZ(1,"button",26),e._UZ(2,"i",27),e.qZA(),e.TgZ(3,"button",28),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,o=e.oxw(3);return e.KtG(o.restoreItemPrice(n))}),e._UZ(4,"i",29),e.qZA()()}}const M=function(i){return{name:i}};function A(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",21)(1,"div",22),e._uU(2),e.qZA(),e.TgZ(3,"div",23)(4,"input",24),e.NdJ("ngModelChange",function(n){const d=e.CHM(t).$implicit;return e.KtG(d.price=n)}),e.qZA(),e.YNc(5,N,5,0,"div",25),e.qZA()()}if(2&i){const t=r.$implicit;e.xp6(1),e.Q6J("ngClass",e.VKq(5,M,t.price&&t.price!=t.backPrice)),e.xp6(1),e.AsE("",null==t?null:t.itemName," (",null==t?null:t.unitOfMeasure,")"),e.xp6(2),e.Q6J("ngModel",t.price),e.xp6(1),e.Q6J("ngIf",t.price&&t.price!=t.backPrice)}}function P(i,r){if(1&i&&(e.TgZ(0,"div",19),e.YNc(1,A,6,7,"div",20),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",null==t?null:t.subItems)}}function T(i,r){if(1&i&&(e.TgZ(0,"option",39),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.measurementId),e.xp6(1),e.hij(" ",t.unitOfMeasure,"")}}function w(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"p",10),e.NdJ("click",function(){const o=e.CHM(t).$implicit,d=e.oxw(3).$implicit,u=e.oxw();return e.KtG(u.selectItem(o,d))}),e._uU(1),e.qZA()}if(2&i){const t=r.$implicit;e.xp6(1),e.AsE(" ",null==t?null:t.itemName," (",null==t?null:t.unitOfMeasure,")")}}function O(i,r){if(1&i&&(e.TgZ(0,"div",40),e.YNc(1,w,2,2,"p",9),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngForOf",t.itemsList)}}function S(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",30)(1,"div",31)(2,"input",32),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw().$implicit;return e.KtG(o.itemName=n)})("keyup",function(){e.CHM(t);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.getItemsByName(n))}),e.qZA(),e.TgZ(3,"select",33),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw().$implicit;return e.KtG(o.measurementId=n)}),e.TgZ(4,"option",34),e._uU(5,"Unit"),e.qZA(),e.YNc(6,T,2,2,"option",35),e.qZA(),e.TgZ(7,"input",36),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw().$implicit;return e.KtG(o.itemPrice=n)}),e.qZA(),e.TgZ(8,"button",37),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,o=e.oxw();return e.KtG(o.addItem(n))}),e._UZ(9,"i",27),e.qZA()(),e.YNc(10,O,2,1,"div",38),e.qZA()}if(2&i){const t=e.oxw().$implicit,s=e.oxw();e.xp6(2),e.Q6J("ngModel",t.itemName),e.xp6(1),e.Q6J("name","item"+t.subCategoryId)("ngModel",t.measurementId),e.xp6(3),e.Q6J("ngForOf",s.measurements),e.xp6(1),e.Q6J("name","price"+t.subCategoryId)("ngModel",t.itemPrice),e.xp6(1),e.Q6J("disabled",!t.itemName||t.itemName.length<3||!t.measurementId),e.xp6(2),e.Q6J("ngIf",t.showList)}}function Z(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",11)(1,"h4",12)(2,"span"),e._uU(3),e.qZA(),e.TgZ(4,"span",13),e.NdJ("click",function(){const o=e.CHM(t).$implicit;return e.KtG(o.show=!o.show)}),e.YNc(5,y,1,2,"i",14),e.YNc(6,x,1,0,"i",15),e.qZA()(),e.YNc(7,P,2,1,"div",16),e.YNc(8,S,11,8,"div",17),e.qZA()}if(2&i){const t=r.$implicit;e.xp6(3),e.Oqu(t.subCategoryName),e.xp6(2),e.Q6J("ngIf",!t.loading),e.xp6(1),e.Q6J("ngIf",t.loading),e.xp6(1),e.Q6J("ngIf",(null==t?null:t.subItems)&&(null==t||null==t.subItems?null:t.subItems.length)),e.xp6(1),e.Q6J("ngIf",t.show)}}const J=[{path:"add",component:(()=>{class i{constructor(t,s,n,o){this.itemsService=t,this.activatedRoute=s,this.categoryService=n,this.serviceProviderService=o,this.subCategoryName="",this.categoryName="",this.showSubcategoryList=!1,this.disabledSubCategory=!0,this.items=[],this.measurements=[],this.subCategories=[]}ngOnInit(){this.activatedRoute.queryParamMap.subscribe(t=>{this.serviceProviderId=Number(t.get("serviceProviderId")),this.categoryId=Number(t.get("categoryId")),this.businesCode=String(t.get("businesCode")),this.getItemsByServiceProvider(),this.getMeasurements()})}getMeasurements(){this.itemsService.getMeasurements().subscribe(t=>{this.measurements=t},t=>{console.log(t)})}addSubCategory(){this.categoryService.AddSubCategory(this.categoryId,this.subCategoryName).subscribe(t=>{this.items.unshift({categoryId:this.categoryId,categoryName:this.categoryName,subCategoryName:this.subCategoryName,subCategoryId:t.subCategoryId,measurementId:"",itemPrice:0,subItems:[],isOpen:!1,show:!1,showList:!1,loading:!1}),this.showSubcategoryList=!1,this.subCategoryName=""},t=>{console.log(t)})}getItemsByName(t){t.showList=!1,this.itemsService.getItemsByCategoryAndSubcategory(t.categoryId,t.subCategoryId,t.itemName).subscribe(s=>{const n=t.subItems.map(o=>o.itemName);t.itemsList=s.filter(o=>!n.includes(o.itemName)),console.log(t),t.showList=!!t.itemsList.length})}selectSubCategory(t){console.log(t),this.subCategoryName="",this.showSubcategoryList=!1,this.items.unshift({categoryId:this.categoryId,categoryName:this.categoryName,subCategoryName:t.subCategoryName,subCategoryId:t.subCategoryId,measurementId:"",itemPrice:0,subItems:[],isOpen:!1,show:!1,showList:!1,loading:!1})}getSubCategoriesByName(){console.log(this.subCategoryName),this.interval&&clearTimeout(this.interval),this.interval=setTimeout(()=>{this.categoryService.GetSubCategoriesWithCategoryId({subCategoryName:this.subCategoryName,categoryId:this.categoryId}).subscribe(t=>{const s=this.items.map(n=>n.subCategoryName);this.subCategories=t.filter(n=>!s.includes(n.subCategoryName)),this.showSubcategoryList=!!this.subCategories.length},console.log)},300)}selectItem(t,s){console.log(s,t),s.showList=!1,s.itemName="",this.serviceProviderService.mapItemToServiceProvider(Number(this.serviceProviderId),t.itemId,0).subscribe(n=>{console.log(n),s.subItems.push({...t,subItems:"",price:0,show:!1})})}toggleSubCategory(){this.subCategoryName="",this.showSubcategoryList=!this.showSubcategoryList}restoreItemPrice(t){t.price=JSON.parse(JSON.stringify(t.backPrice))}updateItemPrice(t){console.log(t),this.itemsService.updateItemPrice(t.itemId,Number(this.serviceProviderId),t.price).subscribe(s=>{console.log(s),t.backPrice=t.price},s=>{console.log(s)})}addItem(t){console.log(t),t.loading=!0,this.itemsService.addItem(t.categoryId,t.subCategoryId,Number(t.measurementId),t.itemName).subscribe(s=>{t.show=!1,this.serviceProviderService.mapItemToServiceProvider(Number(this.serviceProviderId),s.itemId,t.itemPrice).subscribe(n=>{console.log(n),this.getItemsByServiceProvider()},n=>{t.loading=!1})},s=>{t.loading=!1})}getItemsByServiceProvider(){this.itemsService.getItemsByServiceProviderId(this.serviceProviderId).subscribe(t=>{console.log(t),this.items=Object.values(t.reduce((s,n)=>(this.categoryName=n.categoryName,s[n.subCategoryName]||(s[n.subCategoryName]={categoryName:n.categoryName,categoryId:this.categoryId,subCategoryName:n.subCategoryName,subCategoryId:n.subCategoryId,measurementId:"",itemPrice:0,subItems:[],isOpen:!1,show:!1,showList:!1,loading:!1}),s[n.subCategoryName].subItems.push({itemId:n.itemId,show:!0,itemName:n.itemName,price:n.price,backPrice:n.price,subItems:Array.isArray(n.subItems)&&n.subItems.reduce((o,d,u)=>o+(u?(u!==n.subItems.length-1?", ":" and ")+d.itemName:d.itemName),"")||"",unitOfMeasure:n.unitOfMeasure,itemIconURL:n.itemIconURL}),s),{})),console.log(this.items)},t=>{console.log(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b),e.Y36(g.gz),e.Y36(h.G),e.Y36(C.G))},i.\u0275cmp=e.Xpm({type:i,selectors:[["lgs-add-items"]],decls:8,vars:6,consts:[[3,"title","showBack"],[1,"body"],[1,"p-10","pos-relative"],["type","text","name","subCategoryName","placeholder","Enter New Sub Category Name",1,"sub-category-name-input",3,"ngModel","ngModelChange","keyup"],[1,"button-filled","add-sub-category",3,"disabled","click"],[1,"gg-math-plus"],["class","sub-categories-list",4,"ngIf"],["class","card",4,"ngFor","ngForOf"],[1,"sub-categories-list"],["class","text-capitalize",3,"click",4,"ngFor","ngForOf"],[1,"text-capitalize",3,"click"],[1,"card"],[1,"title","text-capitalize"],[3,"click"],[3,"class",4,"ngIf"],["class","gg-spinner",4,"ngIf"],["class","p-10",4,"ngIf"],["class","pos-relative",4,"ngIf"],[1,"gg-spinner"],[1,"p-10"],["class","sub-items",4,"ngFor","ngForOf"],[1,"sub-items"],[3,"ngClass"],[1,"flex"],["type","number",3,"ngModel","ngModelChange"],[3,"click",4,"ngIf"],[1,"button-filled"],[1,"gg-chevron-right"],[1,"button-border",3,"click"],[1,"gg-close"],[1,"pos-relative"],[1,"flex","new-item"],["type","text","name","itemName","placeholder","Item Name",1,"sub-category-name-input",3,"ngModel","ngModelChange","keyup"],[1,"m-b-0",3,"name","ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","Price",3,"name","ngModel","ngModelChange"],[1,"button-filled","add-item",3,"disabled","click"],["class","sub-categories-list items-list",4,"ngIf"],[3,"value"],[1,"sub-categories-list","items-list"]],template:function(t,s){1&t&&(e._UZ(0,"lgs-header",0),e.TgZ(1,"div",1)(2,"div",2)(3,"input",3),e.NdJ("ngModelChange",function(o){return s.subCategoryName=o})("keyup",function(){return s.getSubCategoriesByName()}),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){return s.addSubCategory()}),e._UZ(5,"i",5),e.qZA(),e.YNc(6,f,2,1,"div",6),e.qZA(),e.YNc(7,Z,9,5,"div",7),e.qZA()),2&t&&(e.Q6J("title","Add Items")("showBack",!0),e.xp6(3),e.Q6J("ngModel",s.subCategoryName),e.xp6(1),e.Q6J("disabled",!s.subCategoryName||s.subCategoryName.length<3),e.xp6(2),e.Q6J("ngIf",s.showSubcategoryList),e.xp6(1),e.Q6J("ngForOf",s.items))},dependencies:[l.mk,l.sg,l.O5,v.G,a.YN,a.Kr,a.Fj,a.wV,a.EJ,a.JJ,a.On],styles:[".body[_ngcontent-%COMP%]{padding-bottom:120px}.button-filled.add-sub-category[_ngcontent-%COMP%], .button-filled.add-item[_ngcontent-%COMP%]{min-width:unset;height:51px;position:absolute}.button-filled.add-sub-category[_ngcontent-%COMP%]{right:10px;top:10px}.button-filled.add-item[_ngcontent-%COMP%]{position:relative;padding:10px 5px}select[_ngcontent-%COMP%]{width:100px;margin:0 10px}.sub-category-name-input[_ngcontent-%COMP%]{margin:0}.sub-categories-list[_ngcontent-%COMP%]{position:absolute;z-index:1;background:#fff;top:70px;right:10px;left:10px;padding:10px;border-bottom-left-radius:10px;border:1px solid var(--background-color);border-bottom-right-radius:10px;box-shadow:#64646f33 0 7px 29px;max-height:115px;overflow-y:auto}.sub-categories-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;border-bottom:1px solid var(--background-color);margin:0;padding:10px 5px}.sub-categories-list.items-list[_ngcontent-%COMP%]{top:50px;left:0;right:0}.title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.sub-items[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin:0}.sub-items[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{max-width:55%}.sub-items[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:10px 5px;text-align:center;width:50px;margin-top:10px;margin-bottom:0}.sub-items[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:auto;margin-top:10px;padding:7px 5px}.new-item[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .new-item[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .new-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 5px;text-align:center;margin-bottom:0;height:auto;font-size:13px}.new-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px}.new-item[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:50px;margin-top:0}"]}),i})()},{path:"",pathMatch:"full",redirectTo:"add"}];let k=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[g.Bz.forChild(J),g.Bz]}),i})();var F=c(5130);let E=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[l.ez,k,F.O,a.u5]}),i})()}}]);